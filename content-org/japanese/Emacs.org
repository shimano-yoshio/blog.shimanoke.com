#+TITLE: Emacs Tips
#+LANGUAGE: ja
#+AUTHOR: 島野 善雄
#+EMAIL: shimano.yoshio@gmail.com
# 出版した日付
#+date: <2023-08-31 Thu>
# 更新日を自動的につける
#+hugo_auto_set_lastmod: t
# 見出しをレベル 6 まで出す
#+OPTIONS: H:6 num:nil
#+OPTIONS: toc:1
#+STARTUP: indent
#+hugo_type: post
# 出力するディレクトリ
#+hugo_base_dir: ../..
# 出版するファイル名
#+hugo_section: japanese/docs
#+OPTIONS: creator:nil author:t
#+LANGUAGE: ja
# Hugo のタグ
#+filetags: Emacs
# Hugo のカテゴリー
#+hugo_categories: Ubuntu
# #+hugo_custom_front_matter: :thumbnail images/org-to-hugo.svg


* Emacs についてコツ                                           :RefileTarget:

** Ubuntu MATE で複数の Emacs ディストリビューションを動かす
:PROPERTIES:
:EXPORT_DATE: <2023-09-06 Wed>
:EXPORT_HUGO_SECTION: japanese/posts
:EXPORT_FILE_NAME: install-emacs-on-ubuntu
:EXPORT_OPTIONS: toc:t num:t
:END:

*** 目的
Ubuntu MATE 23.04 に Emacs をインストールする方法を説明します。

また、[[https://github.com/plexus/chemacs2][chemacs2]] を使って複数の Emacs を同時に動かせるようにします。

以下のツールを使います。

- [[https://github.com/plexus/chemacs2][chemacs2]] :: Emacs のバージョンスッチャー
- [[https://www.spacemacs.org/][Spacemacs]] :: 人気のある Emacs のディストリビューション
- [[https://github.com/doomemacs/doomemacs][doomemacs]] :: これも人気のある Emacs のディストリビューション

*** 今回の目標のイメージ

今回の設定を行なうと下図のように Spacemacs と
Doom Emacs を同時に動かすことができます。

#+caption: Spacemacs と Doom Emacs を同時に動かす
#+attr_html: :alt Spacemacs と Doom Emacs を同時に動かす
#+ATTR_HTML: :style float:left;margin:20px 20px 20px 0px;
#+ATTR_HTML: :width 50% :style border:2px solid white;
[[file:images/spaceemacs-and-doom.png]]

*** 環境

今回 Emacs をインストールする環境です。

- Guest OS :: [[https://ubuntu-mate.org/][Ubuntu MATE]] 23.04
- Host OS :: Windowd 11 Professional
- VM 環境: [[https://www.virtualbox.org/][VirtualBox]] 7.0.100

*** Ubuntu MATE への Emacs のインストール

Ubuntu MATE へ Emacs のインストールするには次のようにします。

#+caption: Ubuntu MATE へのEmacsのインストール
#+begin_src sh :eval no
sudo apt -y install emacs emacs-gtk
#+end_src

Emacs のバージョンを確認します:

#+caption: Emacsのバージョン確認
#+begin_src sh :eval no
emacs --version
#+end_src

#+begin_example
GNU Emacs 28.2
Copyright (C) 2022 Free Software Foundation, Inc.
GNU Emacs comes with ABSOLUTELY NO WARRANTY.
You may redistribute copies of GNU Emacs
under the terms of the GNU General Public License.
For more information about these matters, see the file named COPYING.
#+end_example

以上で Emacs 自体のインストールは終了です。

*** Chemacs を使って複数の Emacs をたちあげる

複数の Emacs の異なるディストリビューション、
異なるバージョンを動かしたいことがあります。
そのために私は [[https://github.com/plexus/chemacs2][chemacs2]] を使っていあます。

今回は次の 2 つの Emacs のディストリビューションを
動かします。

- [[https://www.spacemacs.org/][Spacemacs]]
- [[https://github.com/doomemacs/doomemacs][doomemacs]]

[[https://github.com/plexus/chemacs2][chemacs2]] の詳細は以下をごらんください。

- [[https://github.com/plexus/chemacs2][plexus/chemacs2: Emacs version switcher, improved]]


**** 今回使用するディレクトリ

今回使うディレクトリの説明です。
「[[*chemacs の設定][chemacs の設定]]」で重要になります。

- =~/.emacs.d= :: chemacs 用のファイルがはいります
- =~/EmacsDist= :: 複数の Emacs のディレクトリを置くディレクトリ
- =~/EmacsDist/Spacemacs= :: Spqcemacs のディレクトリ
- =~/EmacsDist/DoomEmacs= :: Doom Emacs のディレクトリ
- =~/.spacemacs.d= :: Spacemacs 用の設定がはいるディレクトリ
- ==~/.doom.d= :: Doom Emacs 用の設定がはいるディレクトリ

**** chemacs のインストール

[[https://github.com/plexus/chemacs2][chemacs2]] をインストールします。
ターミナルンから次を順番に実行してください

#+caption: chemacs のインストール
#+begin_src sh :eval no
  # .emacs ファイルの退避
  [ -f ~/.emacs ] && mv ~/.emacs ~/.emacs.bak
  # .emacs.d ディレクトリの退避
  [ -d ~/.emacs.d ] && mv ~/.emacs.d ~/.emacs.default
  # Chemacs のインストール
  git clone https://github.com/plexus/chemacs2.git ~/.emacs.d
#+end_src

既存の Emacs 設定があった場合には、次のように退避されます:

- /~/.emacs/ → /~/.emacs.bak/
- /~/.emacs.d/ → /~/.emacs.defaulta/

以上で chemacs のインストールは終了です。

**** Spacemacs のインストール

今回使用するディレクトリは次のとおりです。

- =~/EmacsDist/Spacemacs= :: Spqcemacs のディレクトリ
- =~/EmacsDist/DoomEmacs= :: Doom Emacs のディレクトリ


***** =~/EmacsDist= ディレクトリの作成
各種 Emacs のディストリビューションを格納するディレクトリを作成します

#+caption: 各種Emacsのディストリビューションを格納するディレクトリno作成
#+begin_src sh :eval no
mkdir ~/EmacsDist
#+end_src

***** Spacemacs のレポジトリのクローン

Spacemacs のレポジトリをクローンします。

#+caption: Spacemacsのレポジトリのクローン
#+begin_src sh :eval no
cd ~/EmacsDist
git clone https://github.com/syl20bnr/spacemacs ~/EmacsDist/Spacemacs
#+end_src

"develop" ブランチをチェックアウトします
必要ないかもしれません。

#+caption: "develop" ブランチのチェックアウト
#+begin_src sh :eval no
cd Spacemacs
git checkout develop
#+end_src

***** =~/.spacemacs.d= ディレクトリの作成

Spacemacs の設定ファイルを格納する
=~/.spacemacs.d= ディレクトリを作成します。

#+caption: =~/.spacemacs.d= ディレクトリの作成
#+begin_src sh :eval no
mkdir ~/.spacemacs.d
#+end_src

ディレクトリの "init.el" ファイルをコピーします。

#+caption: ディレクトリの "init.el" ファイルをコピー
#+begin_src sh :eval no
cp ~/EmacsDist/Spacemacs/init.el .spacemacs.d
#+end_src

以上で Spacemacs のインストールは終了です。

**** Doom Emacs のインストール

doom Emacs をインストールします。
使用されるディレクトリです。

- =~/.spacemacs.d= :: Spacemacs 用の設定がはいるディレクトリ
- ==~/.doom.d= :: Doom Emacs 用の設定がはいるディレクトリ


- =~/.spacemacs.d= :: Spacemacs 用の設定がはいるディレクトリ
- ==~/.doom.d= :: Doom Emacs 用の設定がはいるディレクトリ
  （doom instal で自動的に作成されます）


***** Doom Emacs のレポジトリをクローン
Doom Emacs のレポジトリをクローンします:
すぐに終わります。

#+caption: Doom Emacs のレポジトリをクローン
#+begin_src sh :eval no
  cd ~/EmacsDist
  git clone --depth 1 https://github.com/doomemacs/doomemacs ~/EmacsDist/DoomEmacs
#+end_src

***** =doom install= の実行
次に Doom Emacs をインストールします。
結構時間がかかります。
途中で質問がでるので "y" と入力します。

=~/.doom.d= という、設定ファイルを格納するフォルダが作成されます。

#+caption: doom installの実行
#+begin_src sh :eval no
~/EmacsDist/DoomEmacs/bin/doom install
#+end_src

#+begin_example
Installing Doom Emacs!

✓ Created ~/.doom.d/
  - Creating ~/.doom.d/init.el
  ✓ Done!
  - Creating ~/.doom.d/config.el
  ✓ Done!
  - Creating ~/.doom.d/packages.el
  ✓ Done!
Generate an envvar file? (see `doom help env` for details) (y or n) y
# y と入力します

> Generating envvars file
  ✓ Generated ~/EmacsDist/DoomEmacs/.local/env
Installing plugins
> Installing straight...
...省略

Download and install all-the-icon's fonts? (y or n) Please answer y or n.  Download and install all-the-icon's fonts? (y or n) Please answer y or n.  Download and install all-the-icon's fonts? (y or n) y
# y と入力します
✓  Finished! Doom is ready to go!

But before you doom yourself, here are some things you should know:

1. Don't forget to run 'doom sync', then restart Emacs, after modifying init.el
   or packages.el in ~/.config/doom.

   This command ensures needed packages are installed, orphaned packages are
   removed, and your autoloads/cache files are up to date. When in doubt, run
   'doom sync'!

2. If something goes wrong, run `doom doctor`. It diagnoses common issues with
   your environment and setup, and may offer clues about what is wrong.

3. Use 'doom upgrade' to update Doom. Doing it any other way will require
   additional steps. Run 'doom help upgrade' to understand those extra steps.

4. Access Doom's documentation from within Emacs via 'SPC h d h' or 'C-h d h'
   (or 'M-x doom/help')

Have fun!

✓ Finished in 9m 48s
#+end_example

***** 、=doom sync= の実行
上の出力に書いてあるとおり、=doom sync= を実行します。

#+caption: doom sync の実行
#+begin_src sh :eval no
~/EmacsDist/DoomEmacs/bin/doom sync
#+end_src

#+begin_example
> Synchronizing "default" profile...
  > Regenerating envvars file
    ✓ Generated ~/EmacsDist/DoomEmacs/.local/env
  > Installing packages...
    - No packages need to be installed
  > (Re)building packages...
    - No packages need rebuilding
  > Purging orphaned packages (for the emperor)...
    - Skipping builds
    - Skipping elpa packages
    - Skipping repos
    - Skipping regrafting
    - Skipping native bytecode
  > (Re)building profile in /home/shimano/EmacsDist/DoomEmacs/.local/etc/@/...
    > Deleting old init files...
    > Generating 4 init files...
    > Byte-compiling ~/EmacsDist/DoomEmacs/.local/etc/@init.28.el...
    ✓ Built init.28.elc
  - Restart Emacs or use 'M-x doom/reload' for changes to take effect
#+end_example


以上で Doom Emacs のインストールが終了しました。

**** chemacs の設定

***** =~/.emacs-profiles.el=
=~/.emacs-profiles.el= を作成し、
次のように入力します。

#+BEGIN_SRC elisp :eval no
(("spacemacs" . ((user-emacs-directory . "~/EmacsDist/Spacemacs")
                 (env . (("SPACEMACSDIR" . "~/.spacemacs.d")))))

 ("doom" . ((user-emacs-directory . "~/EmacsDist/DoomEmacs")
            (env . (("DOOMDIR" . "~/.doom.d"))))))
#+END_SRC

以下パラメータの説明です。

- spacemacs
  - user-emacs-directory  ::
    =~/EmacsDist/Spacemacs= は Spacemacs のレポジトリを
    クローンしたディレクトリです
  - SPACEMACSDIR ::
    =~/.spacemacs.d= は Spacemacs の設定ファイルがあるディレクトリです。
ー doom
  - user-emacs-directory ::
    ="~/EmacsDist/DoomEmacs= は Doom Emacs のレポジトリを
    クローンしたディレクトリでう。
    - DOOMDIR ::
      =~/.doom.d= は Doom Emacs の設定ファイルがあるディレクトリです

***** =~/.emacs-profile=

=~/.emacs-profile= を作成し、次のように入力します。

#+caption: =~/.emacs-profile=
#+begin_src sh :eval no
spacemacs
#+end_src

"spacemacs" は =~/.emacs-profiles.el= の中で指定した
エントリーの名前です。ここで指定したものが "emacs" 単体で
起動したときに使用されます。

以上で chemacs の設定は終了です。


**** chemacs の使いかた

Spacemacs を起動するには次のようにします.

#+caption: Spacemacsを起動する
#+begin_src sh :eval no
  emacs --with-profile spacemacs
  # または
  emacs
#+end_src


Doom Emacs を立ち上げるには次のようにします。

#+caption: Doom Emacsを立ち上げる
#+begin_src sh :eval no
emacs --with-profile doom
#+end_src

*** 結論

今回は  [[https://github.com/plexus/chemacs2][chemacs2]]  を使って、
Ubuntu 上で Spacemacs と Doom Emaccs を動かす
方法を紹介しました。

Spacemacs の使いかた/設定については別の機械に紹介します。


** "muhenkan" （無変換）キーを =evil-escape= に割り当てる(Spacemacs)
:PROPERTIES:
:EXPORT_DATE: <2023-09-08 Fri>
:EXPORT_HUGO_SECTION: japanese/posts
:EXPORT_FILE_NAME: bind-muhenkan-to-evil-escape
:EXPORT_OPTIONS: toc:t num:t
:END:

Spacemacs の vim と hybrid の編集モードでは、
"ESC" キーを頻繁に叩きます。

しかし "ESC" キーはホームポジションからはるか遠くにあります。
そこで "ESC" を別のキーにヮリアテます。

日本語 106 キーボードでは、私が使っていない
キーがいくつかあります。

#+caption: 日本語 106 キーボード
#+attr_html: :alt 日本語 106 キーボード
#+ATTR_HTML: :width 50% :style border:2px solid white;
[[file:~/Documents/blog.shimanoke.com/content-org/japanese/images/japanese-keyboad.jpg]]

よって "muhenkan" （無変換）キー （スペースバーの左）を
=evil-escape" に割り当てます。
これで "muhenkan" キーを叩くことと "ESC" キーを
叩くことが同じになりまう

これを Emacs のコンフィギュレーションに追加してください:

#+caption: Bind "muhenkan" key to =evil-escape"
#+BEGIN_SRC emacs-lisp
(define-key global-map (kbd "<muhenkan>") 'evil-escape)
#+END_SRC

日本語 106 キーボードを使ったいない場合には、
"<muhenkan>" を別の使ったいないキーで置き換えてください。


以上です。 Emacs を楽しんでください!


** TODO Spacemacs を起動/設定する

*** Spacemacs の起動

*** モードの選択


- vim ::
  Vil/Vim ユーザーであれば、これを選択するとよいでしょう。
- hybrid ::
  Emacs ユーザーであればこれを選択すると良いかもしれません。
  Vim のキーバインディングに加えて、Emacs のキーバインディングも
  使ううことができます。私はこれを使っています。
- emacs ::
  Emacs ユーザーで、Vim のキーバインディングを使いたくないかたは
  これを選択してください。お勧めはしません。


*** パッケージのインストール

自動的に必要な Emacs のパッケージがインストールされます。
しばらくお待ちください。


*** Spacemacs の終了のしかた

space q q

または hybrid か emacs のかたは

Ctl-+x Ctl+c

が使えます。




*** TODO Spacemacs で Rust を編集する

*** 目的

*** 環境


*** Rust の Ubuntu MATE 23.04 へのインストール

*** 便利なツールのインストール

*** 結論

** TODO Spacemacs で画面のズームイン/ズームアウト

*** 目的


*** 設定

*** 使用方法
- =Ctln+ "-"= ::
  画面のズームアウト
- =Ctln+ "shift" + -"= ::
  画面のズームイン

このキーバインディングはよく使われているようで、
VSCode や qterminal でも使用することができます。


*** 結論

** TODO Spacemacs のフォント設定

** TODO ox-hugo 用のテンプレートを作る

** TODO Org-mode で ox-hugo 用のテンプレートを作る
** TODO ブラウザから Org-mode へリンクをコピーする

** TODO doom-themes を使う 
DEADLINE: <2019-05-22 水>
:PROPERTIES:
:ID:       42ea9280-f4ad-492e-996d-4abcd406eee4
:END:
:LOGBOOK:
- State "TODO"       from "DONE"       [2023-09-08 Fri 10:50]
- State "DONE"       from "TODO"       [2019-05-22 水 15:13]
CLOCK: [2019-05-22 水 10:37]--[2019-05-22 水 12:16] =>  1:39
CLOCK: [2019-05-22 水 10:07]--[2019-05-22 水 10:27] =>  0:20
CLOCK: [2019-05-22 水 09:46]--[2019-05-22 水 10:07] =>  0:21
CLOCK: [2019-05-22 水 09:32]--[2019-05-22 水 09:35] =>  0:03
CLOCK: [2019-05-22 水 08:40]--[2019-05-22 水 08:40] =>  0:00
:END:

- [[https://github.com/hlissner/emacs-doom-themes][hlissner/emacs-doom-themes: An opinionated pack of modern color-themes]]

#+begin_src emacs-lisp
(require 'doom-themes)

;; Global settings (defaults)
(setq doom-themes-enable-bold t    ; if nil, bold is universally disabled
      doom-themes-enable-italic t) ; if nil, italics is universally disabled

;; Load the theme (doom-one, doom-molokai, etc); keep in mind that each theme
;; may have their own settings.
;; (load-theme 'doom-one t)
(load-theme 'doom-dracula t)

;; Enable flashing mode-line on errors
(doom-themes-visual-bell-config)

;; Enable custom neotree theme (all-the-icons must be installed!)
;; (doom-themes-neotree-config)
;; or for treemacs users
(doom-themes-treemacs-config)

;; Corrects (and improves) org-mode's native fontification.
(doom-themes-org-config)
#+end_src

** TODO Emacs でロックファイルを作らないようにする
:PROPERTIES:
:ID:       12dbc3d5-3f14-42c6-9d01-3364d33e1bf6
:END:
: (setq create-lockfiles nil)




** TODO doom-modeline を使う
:PROPERTIES:
:ID:       bfa2360e-02cf-4e80-bccd-5ca600745aad
:END:
:LOGBOOK:
CLOCK: [2019-05-22 水 09:41]--[2019-05-22 水 09:46] =>  0:05
CLOCK: [2019-05-22 水 09:35]--[2019-05-22 水 09:41] =>  0:06
:END:

- [[https://github.com/seagle0128/doom-modeline][seagle0128/doom-modeline: A fancy and fast mode-line inspired by minimalism design.]]

To use doom-modeline, change =dotspacemacs-mode-line-theme= 
in =init.el= to this:

#+BEGIN_SRC emacs-lisp :tangle yes
dotspacemacs-mode-line-theme '(doom)
#+END_SRC

doom-modeline needs all-the-icons fonts
(- [[https://github.com/domtronn/all-the-icons.el][domtronn/all-the-icons.el: A utility package to collect various Icon Fonts and propertize them within Emacs.]])

To install these fonts, run this in Spacemacs:

#+BEGIN_SRC emacs-lisp :tangle yes
all-the-icons-install-fonts
#+END_SRC

Or, if you can't get fonts, run this in a terminal:

#+begin_src sh :eval no
git clone https://github.com/domtronn/all-the-icons.el.git
cp all-the-icons.el/fonts/all-the-icons.ttf all-the-icons.el/fonts/file-icons.ttf all-the-icons.el/fonts/fontawesome.ttf all-the-icons.el/fonts/material-design-icons.ttf all-the-icons.el/fonts/octicons.ttf all-the-icons.el/fonts/weathericons.ttf ~/.fonts 
all-the-icons.el
fc-cache -f -v
#+end_src

Then, restart Spacemacs (=SPC q r=).

